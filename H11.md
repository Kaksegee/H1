# H11
 Harjoituksen tarkoituksena on tehdä Djangon tuotantoasennus.
 
 
### Laitteisto
 
* Käyttöjärjestelmä	Microsoft Windows 10 Enterprise LTSC 64 bit
* Prosessori i5-6600
* RAM 16 GB
* Virtuaaliohjelmisto : Oracle VM VirtualBox
* Virtuaalikoneen käyttöjärjestelmä: Debian-live-11.6.0-amd64-xfce+nonfree.iso
* Virtuaalipalvelin: Linode Nanode 1 GB





## Alustus (11:07)

Aloitin harjoituksen päivittämällä paketit ja asentamalla micro-editoriin bash-completionin komennoilla:

    $ sudo apt-get update
    $  sudo apt-get -y install micro bash-completion
    $ export EDITOR=micro
    
  ![image](https://user-images.githubusercontent.com/106889187/222387971-72c2675c-652f-4ffa-80d0-dbe109db4539.png)
  
    
  Sitten tarkistin että Apache 2 on asennettuna komennolla:
 
    
    $ sudo systemctl status apache2

    
 ![image](https://user-images.githubusercontent.com/106889187/222384836-51eb6bca-4905-4220-a176-1da026700bf8.png)

Apache on asennettuna ja käynnissä. Kävin vielä selaimessa localhost-sivulla ja sain Apachen testisivun auki.

![image](https://user-images.githubusercontent.com/106889187/222385172-2af004a5-f10d-4de7-9c69-e73f5d879ca3.png)


Seuraavaksi vaihdoin Apachen testisivun komennolla:

    $ echo "new page"|sudo tee /var/www/html/index.html
    
 Ja tarkistin selaimessa, että sivu oli muutettu.
 
 ![image](https://user-images.githubusercontent.com/106889187/222386341-53b96707-fbcc-438d-949b-9f3af9507f86.png)

Tämän jälkeen menin kotihakemistoon, loin uuden hakemiston ja lisäsin siihen index.html tiedoston komennoilla:

    $ cd
    $ mkdir -p publicwsgi/r01p4r/static/
    $ echo "I see you statically"|tee publicwsgi/r01p4r/static/index.html

![image](https://user-images.githubusercontent.com/106889187/222389325-53d280b8-9040-4529-a34a-7b55e259f3dc.png)

 Seuraavaksi lisäsin uuden VirtualHostin sudoeditillä, käyttäen komentoa:
 
    $ sudoedit /etc/apache2/sites-available/r01p4r.conf
    
![image](https://user-images.githubusercontent.com/106889187/222390982-0ad6bd30-2a6e-4255-bba8-dd70bd5141fa.png)

Seuraavaksi laitoin uuden luomani nettisivun päälle ja otin testisivun pois päältä komennoilla:

    $ sudo a2ensite r01p4r.conf
    $ sudo a2dissite 000-default.conf 
    
![image](https://user-images.githubusercontent.com/106889187/222391599-5b750d00-5092-4887-be50-cfc79336118e.png)

Tämän jälkeen tein konfiguraatio-testin komennolla:

    $ /sbin/apache2ctl configtest
    
![image](https://user-images.githubusercontent.com/106889187/222392057-05daab4f-42e6-43bd-9354-bb2d4c1a81ff.png)

Konfiguraatiossa ei ollut ongelmia, (AH00558) viittaa vain ongelmaan julkisen nimen tunnistamisessa.

Seuraavaksi käynnistin Apachen uudestaan komennolla:

    $ sudo systemctl restart apache2
    
Ja tarkistin selaimessa, että luotu sisältö tuli näkyviin sivulla

    http://localhost/static/
  
  ![image](https://user-images.githubusercontent.com/106889187/222393038-9c04016f-01cf-4774-be0a-3f11aa555e29.png)


## Djangon asentaminen VirtuaEnviin

Olin aikaisemmin asentanut VirtualEnvin komennoilla:

    $ sudo apt-get update
    $ sudo apt-get -y install virtualenv
    
Joten siirryin hakemistoon 'publicwsgi' ja loin sinne uuden virtuaaliympäristön komennoilla:

    $ cd 
    $ cd publicwsgi/
    $ virtualenv -p python3 --system-site-packages env
    
![image](https://user-images.githubusercontent.com/106889187/222396203-f62dc0e5-5119-4ce1-b702-2d05bf796d5e.png)


Tämän jälkeen aktivoin uuden virtuaaliympäristön komennolla:

    $ source env/bin/activate
    
 Ja tarkistin, että paketit tullaan asentamaan virtuaaliympäristöön komennolla:
 
    $ which pip
    
 ![image](https://user-images.githubusercontent.com/106889187/222396393-78558381-d2fd-4418-bf76-4e3919ca7b0f.png)


Tämän jälkeen listasin micro-editorilla Django-paketin tekstitiedostona komennolla:

    $ micro requirements.txt 
    
 Lisäsin tekstitiedostoon sisälle 'django'.

  ![image](https://user-images.githubusercontent.com/106889187/222396975-bec0ff74-a113-4750-ac70-3095667362a5.png)

  
Tarkistin tiedoston onnistuneen luomisen komennolla:
 
    $ cat requirements.txt
    
Seuraavaksi asensin Djangon hyödyntäen tekstitiedostoa komennolla:

    $ pip install -r requirements.txt

Lopuksi tarkistin Djangon asentumisen ja version komennolla:

    $ django-admin --version
  

![image](https://user-images.githubusercontent.com/106889187/222397309-e8f0219d-0741-4c13-9be8-e8962cf672a1.png)


  
  
   

## DJANGO (12:07)

Aloitin uuden projektin komennolla:

    $ django-admin startproject rojekt

Ja siirryin määrittämään uuden sivuston Apache-konfiguraatiota komennolla:

    $ sudoedit /etc/apache2/sites-available/rojekt.conf
    
![image](https://user-images.githubusercontent.com/106889187/222431072-40d22c5a-c8f3-4d06-a727-9d99113eb8fc.png)




Seuraavaksi asensin Apacheen WSGI-moduulin komennolla:

    $ sudo apt-get -y install libapache2-mod-wsgi-py3

Asennuksen jälkeen tarkistin syntaksin komennolla:

    $ /sbin/apache2ctl configtest

![image](https://user-images.githubusercontent.com/106889187/222405682-d8d8e49f-3416-4647-9bf0-b57061b8c766.png)

Syntaksi oli ok.

Sitten käynnistin Apachen uudestaan ja testaamalla sivuston komennoilla:

    $ sudo systemctl restart apache2
    $ curl -s localhost|grep title
    
 ![image](https://user-images.githubusercontent.com/106889187/222436030-17f1f496-8c4a-4fa7-a368-a2bb7d39ea67.png)

Tarkistin myös että palvelin oli Apache komennolla:

    $ curl -sI localhost|grep Server
    
![image](https://user-images.githubusercontent.com/106889187/222436279-b0ec2019-fda8-451c-a808-6cdb0bba595b.png)

Palvelin oli Apachen.

## Debugin poisto (15:06)

Poistin Debug-ominaisuuden käytöstä muokkaamalla settings.py tiedostoa komennoilla:

    $ cd
    $ cd publicwsgi/rojekt/
    $ micro rojekt/settings.py 

Ja muokkaamalla kohdat:

    DEBUG = False
    ALLOWED_HOSTS = ["localhost"]
    
 Päivitin asetukset komennoilla:
 
    $ touch teroco/wsgi.py
    $ sudo systemctl restart apache2
    
Tämän jälkeen kävin localhost-sivulla selaimessa ja komennolla:

    $ curl -s localhost|grep title
    

![image](https://user-images.githubusercontent.com/106889187/222440012-ad0c371f-7107-45d4-a458-f8412df815cb.png)

![image](https://user-images.githubusercontent.com/106889187/222440230-d337c8f5-cd62-4336-96eb-e63514a47e4d.png)

Ja sain odotetusti error-viestin, sillä en ollut määritelly vielä sinne mitään.

Osoite 'localhost/admin' toimi ja pääsin kirjautumaan sisään.

![image](https://user-images.githubusercontent.com/106889187/222441033-03b9587b-89b9-49bb-88b0-9248a2d601a7.png)



  

  
## (15:11)  
  

    
 ## Lopuksi 
 
 Tässä harjoituksessa loin tietokannan, missä oli weppiliittymä hyödyntäen Djangon kehityspalvelinta.
 
 
## Lähteet

Linux Palvelimet 2023 alkukevät, Tero Karvinen (https://terokarvinen.com/2023/linux-palvelimet-2023-alkukevat/)

Django 4 Instant Customer Database Tutoria, Tero Karvinen - 13.2.2022 (https://terokarvinen.com/2022/django-instant-crm-tutorial/)





#### Tehnyt Roi Partanen (2.3.2023)
